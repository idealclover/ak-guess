<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1"/>
    <meta name="description" content="干员猜猜乐，猜谜小游戏">
    <link rel="manifest" href="./manifest.json"/>
    <title>ak-guess</title>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                let appPromptEvent = null;
                const installBtn = document.getElementById('pwaTips');
                window.addEventListener('appinstalled', function () {
                    console.log('应用已安装');
                    installBtn.hidden = true;
                });
                const closepwaTips = document.getElementById('closepwaTips');
                closepwaTips.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.stopPropagation()
                    localStorage.setItem('close-pwa', '1')
                    installBtn.hidden = true;
                })
                if (!localStorage.getItem('close-pwa')) {
                    window.addEventListener('beforeinstallprompt', function (event) {
                        console.log('触发事件：beforeinstallprompt');
                        event.preventDefault();
                        appPromptEvent = event;
                        installBtn.hidden = false;
                        return false;
                    });
                    installBtn.addEventListener('click', function () {
                        if (appPromptEvent !== null) {
                            appPromptEvent.prompt();
                            appPromptEvent.userChoice.then(function (result) {
                                if (result.outcome === 'accepted') {
                                    console.log('同意安装应用');
                                } else {
                                    console.log('不同意安装应用');
                                }
                                appPromptEvent = null;
                            });
                        }
                    });
                }
            });

        }
    </script>
</head>
<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<div class="pwa-tips" id="pwaTips" hidden>
    是否安装干员猜猜乐到桌面？
    <span id="closepwaTips" class="close">x</span>
</div>
<ak-guess/>
<script crossorigin="anonymous" src="https://unpkg.com/@magic-microservices/magic@1.1.3/dist/index.umd.js"></script>
<script crossorigin="anonymous" src="https://unpkg.com/axios/dist/axios.min.js"></script>
<link href="https://necolas.github.io/normalize.css/8.0.1/normalize.css" rel="stylesheet"/>
<link href="./index.css" rel="stylesheet"/>
<script type="module">
    import App from './index.js'

    magic('ak-guess', App);
</script>
</body>
</html>


